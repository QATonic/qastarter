package {{config.packageName}}.tests;

import {{config.packageName}}.core.WebDriverManager;
import {{config.packageName}}.pages.LoginPage;
{{#if (includes integrations.reporting "Extent Reports")}}
import com.aventstack.extentreports.ExtentReports;
import com.aventstack.extentreports.ExtentTest;
import com.aventstack.extentreports.reporter.ExtentSparkReporter;
import com.aventstack.extentreports.Status;
{{/if}}
import org.junit.jupiter.api.*;
import org.openqa.selenium.WebDriver;
{{#if (includes dependencies "Screenshot")}}
import org.apache.commons.io.FileUtils;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;
import java.io.File;
import java.io.IOException;
{{/if}}
{{#if (includes dependencies "Logging")}}
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
{{/if}}

/**
 * Login and Logout Test Cases
 * Tests the authentication functionality of the application
 */
@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
public class LoginLogoutTest {

    private static WebDriver driver;
    private LoginPage loginPage;
    {{#if (includes dependencies "Logging")}}
    private static final Logger logger = LogManager.getLogger(LoginLogoutTest.class);
    {{/if}}
    {{#if (includes integrations.reporting "Extent Reports")}}
    private static ExtentReports extent;
    private ExtentTest test;
    {{/if}}

    @BeforeAll
    static void setupClass() {
        {{#if (includes dependencies "Logging")}}
        logger.info("Starting Login/Logout Test Suite");
        {{/if}}
        {{#if (includes integrations.reporting "Extent Reports")}}
        ExtentSparkReporter sparkReporter = new ExtentSparkReporter("target/reports/login-logout-test-report.html");
        extent = new ExtentReports();
        extent.attachReporter(sparkReporter);
        {{/if}}
        driver = WebDriverManager.getDriver();
    }

    @BeforeEach
    void setUp() {
        loginPage = new LoginPage(driver);
        {{#if (includes dependencies "Logging")}}
        logger.info("Setting up test case");
        {{/if}}
    }

    @Test
    @Order(1)
    @DisplayName("Verify Login Page Elements")
    void testLoginPageElements() {
        {{#if (includes integrations.reporting "Extent Reports")}}
        test = extent.createTest("Verify Login Page Elements");
        test.log(Status.INFO, "Navigating to login page");
        {{/if}}
        {{#if (includes dependencies "Logging")}}
        logger.info("Testing login page elements visibility");
        {{/if}}
        
        // Navigate to login page
        loginPage.navigateToLoginPage();
        
        // Verify login form elements are displayed
        Assertions.assertTrue(loginPage.isLoginFormDisplayed(), 
            "Login form should be displayed");
        
        {{#if (includes integrations.reporting "Extent Reports")}}
        test.log(Status.PASS, "Login form elements are visible");
        {{/if}}
        {{#if (includes dependencies "Logging")}}
        logger.info("Login page elements test passed");
        {{/if}}
    }

    @Test
    @Order(2)
    @DisplayName("Valid Login Test")
    void testValidLogin() {
        {{#if (includes integrations.reporting "Extent Reports")}}
        test = extent.createTest("Valid Login Test");
        test.log(Status.INFO, "Testing valid login credentials");
        {{/if}}
        {{#if (includes dependencies "Logging")}}
        logger.info("Testing valid login");
        {{/if}}
        
        // Navigate to login page
        loginPage.navigateToLoginPage();
        
        // Perform login with valid credentials
        loginPage.login("admin", "password123");
        
        // Verify successful login
        Assertions.assertTrue(loginPage.isLoggedIn(), 
            "User should be logged in successfully");
        
        String welcomeMessage = loginPage.getWelcomeMessage();
        Assertions.assertFalse(welcomeMessage.isEmpty(), 
            "Welcome message should be displayed");
        
        {{#if (includes integrations.reporting "Extent Reports")}}
        test.log(Status.PASS, "Login successful with message: " + welcomeMessage);
        {{/if}}
        {{#if (includes dependencies "Logging")}}
        logger.info("Valid login test passed");
        {{/if}}
    }

    @Test
    @Order(3)
    @DisplayName("Invalid Login Test")
    void testInvalidLogin() {
        {{#if (includes integrations.reporting "Extent Reports")}}
        test = extent.createTest("Invalid Login Test");
        test.log(Status.INFO, "Testing invalid login credentials");
        {{/if}}
        {{#if (includes dependencies "Logging")}}
        logger.info("Testing invalid login");
        {{/if}}
        
        // Navigate to login page
        loginPage.navigateToLoginPage();
        
        // Attempt login with invalid credentials
        loginPage.login("invalid", "wrongpassword");
        
        // Verify login failed
        Assertions.assertFalse(loginPage.isLoggedIn(), 
            "User should not be logged in with invalid credentials");
        
        String errorMessage = loginPage.getErrorMessage();
        Assertions.assertFalse(errorMessage.isEmpty(), 
            "Error message should be displayed for invalid login");
        
        {{#if (includes integrations.reporting "Extent Reports")}}
        test.log(Status.PASS, "Login failed as expected with error: " + errorMessage);
        {{/if}}
        {{#if (includes dependencies "Logging")}}
        logger.info("Invalid login test passed");
        {{/if}}
    }

    @Test
    @Order(4)
    @DisplayName("Logout Test")
    void testLogout() {
        {{#if (includes integrations.reporting "Extent Reports")}}
        test = extent.createTest("Logout Test");
        test.log(Status.INFO, "Testing logout functionality");
        {{/if}}
        {{#if (includes dependencies "Logging")}}
        logger.info("Testing logout functionality");
        {{/if}}
        
        // First login
        loginPage.navigateToLoginPage();
        loginPage.login("admin", "password123");
        
        // Verify login was successful
        Assertions.assertTrue(loginPage.isLoggedIn(), 
            "User should be logged in before logout test");
        
        // Perform logout
        loginPage.logout();
        
        // Verify logout was successful
        Assertions.assertTrue(loginPage.isLoggedOut(), 
            "User should be logged out successfully");
        
        Assertions.assertTrue(loginPage.isLoginFormDisplayed(), 
            "Login form should be displayed after logout");
        
        {{#if (includes integrations.reporting "Extent Reports")}}
        test.log(Status.PASS, "Logout successful");
        {{/if}}
        {{#if (includes dependencies "Logging")}}
        logger.info("Logout test passed");
        {{/if}}
    }

    @Test
    @Order(5)
    @DisplayName("Empty Credentials Test")
    void testEmptyCredentials() {
        {{#if (includes integrations.reporting "Extent Reports")}}
        test = extent.createTest("Empty Credentials Test");
        test.log(Status.INFO, "Testing empty username and password");
        {{/if}}
        {{#if (includes dependencies "Logging")}}
        logger.info("Testing empty credentials");
        {{/if}}
        
        // Navigate to login page
        loginPage.navigateToLoginPage();
        
        // Attempt login with empty credentials
        loginPage.login("", "");
        
        // Verify login failed
        Assertions.assertFalse(loginPage.isLoggedIn(), 
            "User should not be logged in with empty credentials");
        
        {{#if (includes integrations.reporting "Extent Reports")}}
        test.log(Status.PASS, "Login properly rejected empty credentials");
        {{/if}}
        {{#if (includes dependencies "Logging")}}
        logger.info("Empty credentials test passed");
        {{/if}}
    }

    {{#if (includes dependencies "Screenshot")}}
    void takeScreenshot(String testName) {
        try {
            TakesScreenshot takesScreenshot = (TakesScreenshot) driver;
            File sourceFile = takesScreenshot.getScreenshotAs(OutputType.FILE);
            File destinationFile = new File("target/screenshots/" + testName + "_" + 
                System.currentTimeMillis() + ".png");
            FileUtils.copyFile(sourceFile, destinationFile);
            {{#if (includes dependencies "Logging")}}
            logger.info("Screenshot saved: " + destinationFile.getAbsolutePath());
            {{/if}}
        } catch (IOException e) {
            {{#if (includes dependencies "Logging")}}
            logger.error("Failed to take screenshot: " + e.getMessage());
            {{/if}}
        }
    }
    {{/if}}

    @AfterEach
    void tearDown() {
        {{#if (includes dependencies "Logging")}}
        logger.info("Cleaning up after test case");
        {{/if}}
        
        // Take screenshot on test failure
        {{#if (includes dependencies "Screenshot")}}
        TestInfo testInfo = TestInfoParameterResolver.getTestInfo();
        if (testInfo != null) {
            takeScreenshot(testInfo.getDisplayName());
        }
        {{/if}}
    }

    @AfterAll
    static void tearDownClass() {
        {{#if (includes dependencies "Logging")}}
        logger.info("Login/Logout Test Suite completed");
        {{/if}}
        {{#if (includes integrations.reporting "Extent Reports")}}
        extent.flush();
        {{/if}}
        WebDriverManager.quitDriver();
    }
} 