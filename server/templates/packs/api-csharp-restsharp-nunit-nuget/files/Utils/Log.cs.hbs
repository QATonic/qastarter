using System;
using System.IO;

namespace {{projectNamespace}}.Utils
{
    public class Log
    {
        private static readonly Lazy<Log> _instance = new(() => new Log());
        private readonly string _logFile;
        private static readonly object _lock = new();

        public static Log Instance => _instance.Value;

        private Log()
        {
            var logDir = "logs";
            if (!Directory.Exists(logDir)) Directory.CreateDirectory(logDir);
            var timestamp = DateTime.Now.ToString("yyyy-MM-dd_HH-mm-ss");
            _logFile = Path.Combine(logDir, $"api_test_{timestamp}.log");
        }

        private void Write(string level, string message)
        {
            var logLine = $"{DateTime.Now:yyyy-MM-dd HH:mm:ss} | {level,-8} | {message}";
            Console.WriteLine(logLine);
            lock (_lock) { File.AppendAllText(_logFile, logLine + Environment.NewLine); }
        }

        public void Info(string message) => Write("INFO", message);
        public void Error(string message) => Write("ERROR", message);
        public void Step(string message) => Write("STEP", message);
    }
}