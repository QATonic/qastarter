package {{packageName}}.core;

import io.restassured.specification.RequestSpecification;
import {{packageName}}.config.ConfigurationReader;
import {{packageName}}.utils.JSONUtils;
{{#if utilities.logger}}
import {{packageName}}.utils.Log;
{{/if}}

import java.util.Map;

import static io.restassured.RestAssured.given;

/**
 * Request builder for constructing REST Assured requests
 * Provides fluent API for building requests with various configurations
 */
public class RequestBuilder {

    private final String contentType;
    private final String acceptType;

    public RequestBuilder() {
        this.contentType = ConfigurationReader.getProperty("api.content.type", "application/json");
        this.acceptType = ConfigurationReader.getProperty("api.accept.type", "application/json");
    }

    /**
     * Build base request specification with default headers
     * 
     * @return RequestSpecification with base configuration
     */
    public RequestSpecification buildBaseRequest() {
        {{#if utilities.logger}}
        Log.debug("Building base request specification");
        {{/if}}
        
        return given()
                .contentType(contentType)
                .accept(acceptType)
                .relaxedHTTPSValidation();
    }

    /**
     * Build request with custom headers
     * 
     * @param headers Map of custom headers
     * @return RequestSpecification with custom headers
     */
    public RequestSpecification buildRequestWithHeaders(Map<String, String> headers) {
        {{#if utilities.logger}}
        Log.debug("Building request with custom headers: " + headers);
        {{/if}}
        
        RequestSpecification request = buildBaseRequest();
        
        if (headers != null && !headers.isEmpty()) {
            request.headers(headers);
        }
        
        return request;
    }

    /**
     * Build request with JSON body
     * 
     * @param requestBody Request body object
     * @return RequestSpecification with JSON body
     */
    public RequestSpecification buildRequestWithBody(Object requestBody) {
        {{#if utilities.logger}}
        Log.debug("Building request with JSON body");
        {{/if}}
        
        RequestSpecification request = buildBaseRequest();
        
        if (requestBody != null) {
            String jsonBody = JSONUtils.objectToJson(requestBody);
            request.body(jsonBody);
            
            {{#if utilities.logger}}
            Log.debug("Request body: " + jsonBody);
            {{/if}}
        }
        
        return request;
    }

    /**
     * Build request with body and custom headers
     * 
     * @param requestBody Request body object
     * @param headers Map of custom headers
     * @return RequestSpecification with body and headers
     */
    public RequestSpecification buildRequestWithBodyAndHeaders(Object requestBody, Map<String, String> headers) {
        {{#if utilities.logger}}
        Log.debug("Building request with body and custom headers");
        {{/if}}
        
        RequestSpecification request = buildRequestWithBody(requestBody);
        
        if (headers != null && !headers.isEmpty()) {
            request.headers(headers);
        }
        
        return request;
    }

    /**
     * Build request with query parameters
     * 
     * @param queryParams Map of query parameters
     * @return RequestSpecification with query parameters
     */
    public RequestSpecification buildRequestWithQueryParams(Map<String, String> queryParams) {
        {{#if utilities.logger}}
        Log.debug("Building request with query parameters: " + queryParams);
        {{/if}}
        
        RequestSpecification request = buildBaseRequest();
        
        if (queryParams != null && !queryParams.isEmpty()) {
            request.queryParams(queryParams);
        }
        
        return request;
    }

    /**
     * Build request with path parameters
     * 
     * @param pathParams Map of path parameters
     * @return RequestSpecification with path parameters
     */
    public RequestSpecification buildRequestWithPathParams(Map<String, String> pathParams) {
        {{#if utilities.logger}}
        Log.debug("Building request with path parameters: " + pathParams);
        {{/if}}
        
        RequestSpecification request = buildBaseRequest();
        
        if (pathParams != null && !pathParams.isEmpty()) {
            request.pathParams(pathParams);
        }
        
        return request;
    }

    /**
     * Build authenticated request with Bearer token
     * 
     * @param token Authentication token
     * @return RequestSpecification with authorization header
     */
    public RequestSpecification buildAuthenticatedRequest(String token) {
        {{#if utilities.logger}}
        Log.debug("Building authenticated request with Bearer token");
        {{/if}}
        
        RequestSpecification request = buildBaseRequest();
        
        if (token != null && !token.isEmpty()) {
            request.header("Authorization", "Bearer " + token);
        }
        
        return request;
    }

    /**
     * Build authenticated request with Bearer token and body
     * 
     * @param requestBody Request body object
     * @param token Authentication token
     * @return RequestSpecification with authorization header and body
     */
    public RequestSpecification buildAuthenticatedRequestWithBody(Object requestBody, String token) {
        {{#if utilities.logger}}
        Log.debug("Building authenticated request with Bearer token and body");
        {{/if}}
        
        RequestSpecification request = buildRequestWithBody(requestBody);
        
        if (token != null && !token.isEmpty()) {
            request.header("Authorization", "Bearer " + token);
        }
        
        return request;
    }

    /**
     * Build request with basic authentication
     * 
     * @param username Username for basic auth
     * @param password Password for basic auth
     * @return RequestSpecification with basic authentication
     */
    public RequestSpecification buildBasicAuthRequest(String username, String password) {
        {{#if utilities.logger}}
        Log.debug("Building request with basic authentication");
        {{/if}}
        
        return buildBaseRequest().auth().basic(username, password);
    }

    /**
     * Build request with API key authentication
     * 
     * @param apiKeyName API key header name
     * @param apiKeyValue API key value
     * @return RequestSpecification with API key header
     */
    public RequestSpecification buildApiKeyRequest(String apiKeyName, String apiKeyValue) {
        {{#if utilities.logger}}
        Log.debug("Building request with API key authentication");
        {{/if}}
        
        return buildBaseRequest().header(apiKeyName, apiKeyValue);
    }

    /**
     * Build request with form parameters
     * 
     * @param formParams Map of form parameters
     * @return RequestSpecification with form parameters
     */
    public RequestSpecification buildFormRequest(Map<String, String> formParams) {
        {{#if utilities.logger}}
        Log.debug("Building request with form parameters: " + formParams);
        {{/if}}
        
        RequestSpecification request = given()
                .contentType("application/x-www-form-urlencoded")
                .accept(acceptType)
                .relaxedHTTPSValidation();
        
        if (formParams != null && !formParams.isEmpty()) {
            request.formParams(formParams);
        }
        
        return request;
    }

    /**
     * Build multipart request for file uploads
     * 
     * @param filePath Path to file to upload
     * @param fileParamName Name of the file parameter
     * @return RequestSpecification for multipart request
     */
    public RequestSpecification buildMultipartRequest(String filePath, String fileParamName) {
        {{#if utilities.logger}}
        Log.debug("Building multipart request for file upload: " + filePath);
        {{/if}}
        
        return given()
                .multiPart(fileParamName, new java.io.File(filePath))
                .accept(acceptType)
                .relaxedHTTPSValidation();
    }

    /**
     * Build request with custom timeout
     * 
     * @param timeoutMs Timeout in milliseconds
     * @return RequestSpecification with custom timeout
     */
    public RequestSpecification buildRequestWithTimeout(int timeoutMs) {
        {{#if utilities.logger}}
        Log.debug("Building request with custom timeout: " + timeoutMs + "ms");
        {{/if}}
        
        return buildBaseRequest()
                .config(io.restassured.config.RestAssuredConfig.config()
                        .httpClient(io.restassured.config.HttpClientConfig.httpClientConfig()
                                .setParam("http.socket.timeout", timeoutMs)
                                .setParam("http.connection.timeout", timeoutMs)));
    }
}