from typing import Dict, Any, Optional


class RequestBuilder:
    """Builder pattern for constructing HTTP requests."""
    
    def __init__(self):
        self._headers: Dict[str, str] = {}
        self._params: Dict[str, Any] = {}
        self._json: Optional[Dict[str, Any]] = None
        self._data: Optional[Any] = None
    
    def with_header(self, key: str, value: str) -> "RequestBuilder":
        """Add a header."""
        self._headers[key] = value
        return self
    
    def with_headers(self, headers: Dict[str, str]) -> "RequestBuilder":
        """Add multiple headers."""
        self._headers.update(headers)
        return self
    
    def with_param(self, key: str, value: Any) -> "RequestBuilder":
        """Add a query parameter."""
        self._params[key] = value
        return self
    
    def with_params(self, params: Dict[str, Any]) -> "RequestBuilder":
        """Add multiple query parameters."""
        self._params.update(params)
        return self
    
    def with_json(self, json_data: Dict[str, Any]) -> "RequestBuilder":
        """Set JSON body."""
        self._json = json_data
        return self
    
    def with_data(self, data: Any) -> "RequestBuilder":
        """Set request data."""
        self._data = data
        return self
    
    def with_content_type(self, content_type: str) -> "RequestBuilder":
        """Set Content-Type header."""
        return self.with_header("Content-Type", content_type)
    
    def with_accept(self, accept: str) -> "RequestBuilder":
        """Set Accept header."""
        return self.with_header("Accept", accept)
    
    def with_bearer_token(self, token: str) -> "RequestBuilder":
        """Set Bearer token."""
        return self.with_header("Authorization", f"Bearer {token}")
    
    def with_api_key(self, api_key: str, header_name: str = "X-API-Key") -> "RequestBuilder":
        """Set API key."""
        return self.with_header(header_name, api_key)
    
    def build(self) -> Dict[str, Any]:
        """Build the request kwargs."""
        kwargs = {}
        
        if self._headers:
            kwargs["headers"] = self._headers
        if self._params:
            kwargs["params"] = self._params
        if self._json is not None:
            kwargs["json"] = self._json
        if self._data is not None:
            kwargs["data"] = self._data
        
        return kwargs
    
    def reset(self) -> "RequestBuilder":
        """Reset the builder."""
        self._headers = {}
        self._params = {}
        self._json = None
        self._data = None
        return self
