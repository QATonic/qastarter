package {{javaPackage}}.core;

import io.appium.java_client.windows.WindowsDriver;
import io.appium.java_client.windows.options.WindowsOptions;
import {{javaPackage}}.config.ConfigReader;
import {{javaPackage}}.utils.Log;

import java.net.URL;
import java.time.Duration;

/**
 * WinAppDriver Manager - Windows desktop driver lifecycle.
 * 
 * Sample App: Windows Calculator
 * 
 * Prerequisites:
 * 1. Enable Developer Mode in Windows Settings
 * 2. Download WinAppDriver from https://github.com/microsoft/WinAppDriver
 * 3. Run WinAppDriver.exe as Administrator
 */
public class WinAppDriverManager {

    private static ThreadLocal<WindowsDriver> driver = new ThreadLocal<>();

    public static WindowsDriver getDriver() {
        return driver.get();
    }

    public static void initDriver() {
        Log.info("Initializing WinAppDriver");

        try {
            URL serverUrl = new URL(ConfigReader.getWinAppDriverUrl());

            WindowsOptions options = new WindowsOptions()
                .setApp(ConfigReader.getAppPath());

            driver.set(new WindowsDriver(serverUrl, options));
            driver.get().manage().timeouts().implicitlyWait(
                Duration.ofSeconds(ConfigReader.getImplicitWait())
            );

            Log.info("WinAppDriver initialized successfully");
        } catch (Exception e) {
            Log.error("Failed to initialize driver: " + e.getMessage());
            throw new RuntimeException(e);
        }
    }

    public static void quitDriver() {
        if (driver.get() != null) {
            driver.get().quit();
            driver.remove();
            Log.info("WinAppDriver closed");
        }
    }
}