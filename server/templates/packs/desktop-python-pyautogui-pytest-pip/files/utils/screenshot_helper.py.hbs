import os
from datetime import datetime
import pyautogui
from config.settings import Settings
from utils.logger import Logger

class ScreenshotHelper:
    @staticmethod
    def take_screenshot(test_name: str):
        if not Settings.SCREENSHOT_ON_FAILURE:
            return
        
        try:
            screenshot_dir = Settings.SCREENSHOT_PATH
            if not os.path.exists(screenshot_dir):
                os.makedirs(screenshot_dir)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            filename = f"{test_name}_{timestamp}.png"
            filepath = os.path.join(screenshot_dir, filename)
            
            screenshot = pyautogui.screenshot()
            screenshot.save(filepath)
            Logger.info(f"Screenshot saved: {filepath}")
            return filepath
        except Exception as e:
            Logger.error(f"Failed to take screenshot: {str(e)}")
            return None
