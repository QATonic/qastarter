using NUnit.Framework;
using {{projectNamespace}}.Core;
using {{projectNamespace}}.Pages;
using {{projectNamespace}}.Utils;
using System.Collections.Generic;

namespace {{projectNamespace}}.Tests
{
[TestFixture]
public class LoginTests
{
private LoginPage _loginPage;

[SetUp]
public void Setup()
{
AppiumManager.InitDriver();
_loginPage = new LoginPage();
}

[TearDown]
public void TearDown() => AppiumManager.QuitDriver();

[Test, Category("Smoke")]
public void ValidLogin_ShowsProducts()
{
Log.Instance.Step("Valid login test");
_loginPage.Login("standard_user", "secret_sauce");
Assert.That(_loginPage.IsLoginSuccessful(), Is.True);
}

[Test, Category("Regression")]
public void InvalidLogin_ShowsError()
{
Log.Instance.Step("Invalid login test");
_loginPage.Login("invalid_user", "wrong_password");
Assert.That(_loginPage.IsErrorDisplayed(), Is.True);
}

{{#if utilities.dataProvider}}
/// <summary>
    /// Data-driven test using TestCaseSource with CSV data.
    /// Reads test data from testdata/users.csv
    /// </summary>
[Test, Category("Regression")]
[TestCaseSource(nameof(GetLoginTestData))]
public void DataDrivenLogin_ValidatesCredentials(string username, string password, string expected)
{
Log.Instance.Step($"Data-driven login test for: {username}");

_loginPage.Login(username, password);

if (expected == "success")
{
Assert.That(_loginPage.IsLoginSuccessful(), Is.True,
$"Login should succeed for: {username}");
}
else
{
Assert.That(_loginPage.IsErrorDisplayed(), Is.True,
$"Error should display for: {username}");
}
}

private static IEnumerable<object[]> GetLoginTestData()
    {
    var testData = TestDataReader.ReadCsv("users.csv");
    foreach (var row in testData)
    {
    yield return new object[] { row["username"], row["password"], row["expected"] };
    }
    }
    {{/if}}
    }
    }