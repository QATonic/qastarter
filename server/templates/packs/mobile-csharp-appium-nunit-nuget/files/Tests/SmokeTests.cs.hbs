using NUnit.Framework;
using OpenQA.Selenium;
using OpenQA.Selenium.Appium.Android;
using OpenQA.Selenium.Appium.iOS;
using {{projectName}}.Config;
using {{projectName}}.Tests.Pages;

namespace {{projectName}}.Tests;

[TestFixture]
public class SmokeTests : BaseTest
{
    private LoginPage _loginPage = null!;

    [SetUp]
    public void SetUpPages()
    {
        _loginPage = new LoginPage(Driver);
    }

    [Test]
    public void ShouldLaunchAppSuccessfully()
    {
        Assert.That(Driver, Is.Not.Null, "Driver should be initialized");
        
        if (Settings.IsAndroid)
        {
            var androidDriver = Driver as AndroidDriver;
            var currentActivity = androidDriver?.CurrentActivity;
            Assert.That(currentActivity, Is.Not.Null.And.Not.Empty, "Current activity should be available");
        }
        else
        {
            var pageSource = Driver.PageSource;
            Assert.That(pageSource, Is.Not.Null.And.Not.Empty, "Page source should be available");
        }
    }

    [Test]
    public void ShouldDisplayLoginPageElements()
    {
        var isUsernameDisplayed = _loginPage.IsDisplayed(
            By.Id("com.example.app:id/username")
        );
        Assert.That(isUsernameDisplayed, Is.True, "Username input should be displayed");
        
        var isPasswordDisplayed = _loginPage.IsDisplayed(
            By.Id("com.example.app:id/password")
        );
        Assert.That(isPasswordDisplayed, Is.True, "Password input should be displayed");
        
        var isLoginButtonDisplayed = _loginPage.IsDisplayed(
            By.Id("com.example.app:id/loginButton")
        );
        Assert.That(isLoginButtonDisplayed, Is.True, "Login button should be displayed");
    }

    [Test]
    public void ShouldVerifyPlatformSpecificFeatures()
    {
        if (Settings.IsAndroid)
        {
            var androidDriver = Driver as AndroidDriver;
            var currentPackage = androidDriver?.CurrentPackage;
            Assert.That(currentPackage, Is.Not.Null.And.Not.Empty, "Current package should be available");
        }
        else if (Settings.IsIOS)
        {
            var iosDriver = Driver as IOSDriver;
            var bundleId = iosDriver?.Capabilities.GetCapability("bundleId");
            Assert.That(bundleId, Is.Not.Null, "Bundle ID should be available");
        }
    }
}
