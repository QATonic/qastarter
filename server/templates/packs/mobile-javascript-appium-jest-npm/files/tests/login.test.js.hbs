const LoginPage = require('./pages/LoginPage');
const HomePage = require('./pages/HomePage');
const TestDataReader = require('./utils/TestDataReader');

const TEST_USERNAME = 'standard_user';
const TEST_PASSWORD = 'secret_sauce';

describe('Login Tests', () => {
let loginPage;
let homePage;

beforeEach(() => {
loginPage = new LoginPage(driver);
homePage = new HomePage(driver);
});

test('should login with valid credentials', async () => {
try {
await loginPage.login(TEST_USERNAME, TEST_PASSWORD);
const isHomeDisplayed = await homePage.isHomePageDisplayed();
expect(isHomeDisplayed).toBe(true);
} catch (error) {
await driver.saveScreenshot('screenshots/FAILED-login-valid.png');
throw error;
}
});

test('should show error with invalid credentials', async () => {
try {
await loginPage.login('invalid_user', 'wrong_password');
const isErrorDisplayed = await loginPage.isErrorDisplayed();
expect(isErrorDisplayed).toBe(true);
} catch (error) {
await driver.saveScreenshot('screenshots/FAILED-login-invalid.png');
throw error;
}
});

{{#if utilities.dataProvider}}
/**
* Data-driven tests using test.each
* Reads test data from data/users.json
*/
describe('Data-driven login tests', () => {
const testData = TestDataReader.readJson('users.json');

test.each(testData)(
'should verify login for user: $username',
async ({ username, password, expected }) => {
try {
await loginPage.login(username, password);

if (expected === 'success') {
const isHomeDisplayed = await homePage.isHomePageDisplayed();
expect(isHomeDisplayed).toBe(true);
} else {
const isErrorDisplayed = await loginPage.isErrorDisplayed();
expect(isErrorDisplayed).toBe(true);
}
} catch (error) {
await driver.saveScreenshot(`screenshots/FAILED-login-${username}.png`);
throw error;
}
}
);
});
{{/if}}
});