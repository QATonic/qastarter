import LoginPage from './pages/LoginPage';
import { isAndroid, isIOS } from './utils/helpers';

describe('Smoke Tests', () => {
  let loginPage: LoginPage;

  beforeEach(() => {
    loginPage = new LoginPage(driver);
  });

  test('should launch app successfully', async () => {
    try {
      expect(driver).toBeDefined();
      
      if (isAndroid()) {
        const currentActivity = await driver.getCurrentActivity();
        expect(currentActivity).toBeDefined();
      } else {
        const pageSource = await driver.getPageSource();
        expect(pageSource).toBeDefined();
      }
    } catch (error) {
      await driver.saveScreenshot('screenshots/FAILED-app-launch.png');
      throw error;
    }
  });

  test('should display login page elements', async () => {
    try {
      const isUsernameDisplayed = await loginPage.isDisplayed(loginPage.usernameInput);
      expect(isUsernameDisplayed).toBe(true);
      
      const isPasswordDisplayed = await loginPage.isDisplayed(loginPage.passwordInput);
      expect(isPasswordDisplayed).toBe(true);
      
      const isLoginButtonDisplayed = await loginPage.isDisplayed(loginPage.loginButton);
      expect(isLoginButtonDisplayed).toBe(true);
    } catch (error) {
      await driver.saveScreenshot('screenshots/FAILED-login-elements-display.png');
      throw error;
    }
  });

  test('should verify platform-specific features', async () => {
    try {
      if (isAndroid()) {
        const currentPackage = await driver.getCurrentPackage();
        expect(currentPackage).toBeDefined();
      } else if (isIOS()) {
        const capabilities = await driver.capabilities;
        const bundleId = (capabilities as any).bundleId;
        expect(bundleId).toBeDefined();
      }
    } catch (error) {
      await driver.saveScreenshot('screenshots/FAILED-platform-features.png');
      throw error;
    }
  });
});
