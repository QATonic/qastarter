import { Browser } from 'webdriverio';

export default class AndroidGestures {
  private driver: Browser<'async'>;

  constructor(driver: Browser<'async'>) {
    this.driver = driver;
  }

  async swipe(startX: number, startY: number, endX: number, endY: number, duration: number = 1000): Promise<void> {
    await this.driver.performActions([{
      type: 'pointer',
      id: 'finger1',
      parameters: { pointerType: 'touch' },
      actions: [
        { type: 'pointerMove', duration: 0, x: startX, y: startY },
        { type: 'pointerDown', button: 0 },
        { type: 'pause', duration },
        { type: 'pointerMove', duration, x: endX, y: endY },
        { type: 'pointerUp', button: 0 }
      ]
    }]);
  }

  async swipeUp(): Promise<void> {
    const size = await this.driver.getWindowSize();
    const startX = size.width / 2;
    const startY = size.height * 0.8;
    const endX = size.width / 2;
    const endY = size.height * 0.2;
    await this.swipe(startX, startY, endX, endY);
  }

  async swipeDown(): Promise<void> {
    const size = await this.driver.getWindowSize();
    const startX = size.width / 2;
    const startY = size.height * 0.2;
    const endX = size.width / 2;
    const endY = size.height * 0.8;
    await this.swipe(startX, startY, endX, endY);
  }

  async swipeLeft(): Promise<void> {
    const size = await this.driver.getWindowSize();
    const startX = size.width * 0.8;
    const startY = size.height / 2;
    const endX = size.width * 0.2;
    const endY = size.height / 2;
    await this.swipe(startX, startY, endX, endY);
  }

  async swipeRight(): Promise<void> {
    const size = await this.driver.getWindowSize();
    const startX = size.width * 0.2;
    const startY = size.height / 2;
    const endX = size.width * 0.8;
    const endY = size.height / 2;
    await this.swipe(startX, startY, endX, endY);
  }

  async scrollToText(text: string) {
    const element = await this.driver.$(`android=new UiScrollable(new UiSelector().scrollable(true)).scrollIntoView(new UiSelector().text("${text}"))`);
    return element;
  }

  async longPress(locator: string, duration: number = 2000): Promise<void> {
    const element = await this.driver.$(locator);
    await this.driver.performActions([{
      type: 'pointer',
      id: 'finger1',
      parameters: { pointerType: 'touch' },
      actions: [
        { type: 'pointerMove', duration: 0, origin: element },
        { type: 'pointerDown', button: 0 },
        { type: 'pause', duration },
        { type: 'pointerUp', button: 0 }
      ]
    }]);
  }
}
