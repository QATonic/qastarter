using System;
using System.IO;

namespace {{projectNamespace}}.Utils
{
    /// <summary>
    /// Logger with timestamp-based log files.
    /// Logs saved to: logs/test_{timestamp}.log
    /// </summary>
    public class Logger
    {
        private static readonly Lazy<Logger> _instance = new(() => new Logger());
        private readonly string _logFile;
        private static readonly object _lock = new();

        public static Logger Instance => _instance.Value;

        private Logger()
        {
            var logDir = "logs";
            if (!Directory.Exists(logDir)) Directory.CreateDirectory(logDir);
            
            var timestamp = DateTime.Now.ToString("yyyy-MM-dd_HH-mm-ss");
            _logFile = Path.Combine(logDir, $"test_{timestamp}.log");
        }

        private void Log(string level, string message)
        {
            var logLine = $"{DateTime.Now:yyyy-MM-dd HH:mm:ss} | {level,-8} | {message}";
            Console.WriteLine(logLine);
            lock (_lock) { File.AppendAllText(_logFile, logLine + Environment.NewLine); }
        }

        public void Info(string message) => Log("INFO", message);
        public void Error(string message) => Log("ERROR", message);
        public void Step(string message) => Log("STEP", message);
        public void TestStart(string testName) => Log("INFO", $"TEST START: {testName}");
        public void TestEnd(string testName, string status) => Log("INFO", $"TEST END: {testName} - {status}");
    }
}