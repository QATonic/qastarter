package {{javaPackage}}.utils;

import com.microsoft.playwright.Page;
import com.microsoft.playwright.Locator;
import com.microsoft.playwright.options.KeyboardModifier;

import java.nio.file.Paths;
import java.util.Arrays;

/**
 * Utility class for common Playwright actions and interactions.
 * Provides reusable action methods for complex user interactions.
 */
public class PlaywrightActions {
    
    private final Page page;
    
    public PlaywrightActions(Page page) {
        this.page = page;
    }
    
    /**
     * Click element with force
     * @param selector Element selector
     */
    public void forceClick(String selector) {
        Log.info("Force clicking: " + selector);
        page.click(selector, new Page.ClickOptions().setForce(true));
    }
    
    /**
     * Click element at specific position
     * @param selector Element selector
     * @param x X coordinate
     * @param y Y coordinate
     */
    public void clickAtPosition(String selector, int x, int y) {
        Log.info("Clicking at position (" + x + ", " + y + ") on: " + selector);
        page.click(selector, new Page.ClickOptions().setPosition(x, y));
    }
    
    /**
     * Click and hold on element
     * @param selector Element selector
     * @param delayMs Delay in milliseconds
     */
    public void clickAndHold(String selector, int delayMs) {
        Log.info("Click and hold on: " + selector);
        page.click(selector, new Page.ClickOptions().setDelay(delayMs));
    }
    
    /**
     * Drag and drop element
     * @param sourceSelector Source element selector
     * @param targetSelector Target element selector
     */
    public void dragAndDrop(String sourceSelector, String targetSelector) {
        Log.info("Drag and drop from: " + sourceSelector + " to: " + targetSelector);
        page.dragAndDrop(sourceSelector, targetSelector);
    }
    
    /**
     * Upload file to input element
     * @param selector File input selector
     * @param filePath Path to file
     */
    public void uploadFile(String selector, String filePath) {
        Log.info("Uploading file: " + filePath + " to: " + selector);
        page.setInputFiles(selector, Paths.get(filePath));
    }
    
    /**
     * Upload multiple files
     * @param selector File input selector
     * @param filePaths Array of file paths
     */
    public void uploadMultipleFiles(String selector, String[] filePaths) {
        Log.info("Uploading multiple files to: " + selector);
        page.setInputFiles(selector, Arrays.stream(filePaths)
            .map(Paths::get)
            .toArray(java.nio.file.Path[]::new));
    }
    
    /**
     * Press keyboard key
     * @param key Key to press (e.g., "Enter", "Tab", "Escape")
     */
    public void pressKey(String key) {
        Log.info("Pressing key: " + key);
        page.keyboard().press(key);
    }
    
    /**
     * Type text with keyboard
     * @param text Text to type
     */
    public void typeText(String text) {
        Log.info("Typing text: " + text);
        page.keyboard().type(text);
    }
    
    /**
     * Press key combination (e.g., Ctrl+C)
     * @param modifiers Keyboard modifiers (Ctrl, Shift, Alt, Meta)
     * @param key Key to press
     */
    public void pressKeyCombination(KeyboardModifier[] modifiers, String key) {
        Log.info("Pressing key combination with modifiers: " + Arrays.toString(modifiers) + " + " + key);
        page.keyboard().press(key, new com.microsoft.playwright.Keyboard.PressOptions().setModifiers(Arrays.asList(modifiers)));
    }
    
    /**
     * Focus on element
     * @param selector Element selector
     */
    public void focus(String selector) {
        Log.info("Focusing on: " + selector);
        page.focus(selector);
    }
    
    /**
     * Blur element (remove focus)
     * @param selector Element selector
     */
    public void blur(String selector) {
        Log.info("Blurring: " + selector);
        page.evaluate("element => element.blur()", page.locator(selector));
    }
    
    /**
     * Scroll page by pixels
     * @param x X pixels
     * @param y Y pixels
     */
    public void scrollBy(int x, int y) {
        Log.info("Scrolling by: (" + x + ", " + y + ")");
        page.evaluate(String.format("window.scrollBy(%d, %d)", x, y));
    }
    
    /**
     * Scroll to top of page
     */
    public void scrollToTop() {
        Log.info("Scrolling to top");
        page.evaluate("window.scrollTo(0, 0)");
    }
    
    /**
     * Scroll to bottom of page
     */
    public void scrollToBottom() {
        Log.info("Scrolling to bottom");
        page.evaluate("window.scrollTo(0, document.body.scrollHeight)");
    }
    
    /**
     * Scroll element into view
     * @param selector Element selector
     */
    public void scrollIntoView(String selector) {
        Log.info("Scrolling into view: " + selector);
        page.locator(selector).scrollIntoViewIfNeeded();
    }
    
    /**
     * Get element bounding box
     * @param selector Element selector
     * @return Bounding box with x, y, width, height
     */
    public com.microsoft.playwright.Locator.BoundingBox getBoundingBox(String selector) {
        return page.locator(selector).boundingBox();
    }
    
    /**
     * Take element screenshot
     * @param selector Element selector
     * @param filePath Output file path
     */
    public void takeElementScreenshot(String selector, String filePath) {
        Log.info("Taking element screenshot: " + selector);
        page.locator(selector).screenshot(new Locator.ScreenshotOptions().setPath(Paths.get(filePath)));
    }
    
    /**
     * Highlight element (for debugging)
     * @param selector Element selector
     */
    public void highlightElement(String selector) {
        String script = "element.style.border='3px solid red'";
        page.evaluate(script, page.locator(selector));
    }
    
    /**
     * Remove highlight from element
     * @param selector Element selector
     */
    public void removeHighlight(String selector) {
        String script = "element.style.border=''";
        page.evaluate(script, page.locator(selector));
    }
    
    /**
     * Click element using JavaScript
     * @param selector Element selector
     */
    public void clickWithJavaScript(String selector) {
        Log.info("Clicking with JavaScript: " + selector);
        page.evaluate("element.click()", page.locator(selector));
    }
    
    /**
     * Set element value using JavaScript
     * @param selector Element selector
     * @param value Value to set
     */
    public void setValueWithJavaScript(String selector, String value) {
        Log.info("Setting value with JavaScript: " + selector);
        String script = String.format("element.value='%s'", value);
        page.evaluate(script, page.locator(selector));
    }
    
    /**
     * Wait and click when element is ready
     * @param selector Element selector
     */
    public void waitAndClick(String selector) {
        page.locator(selector).click();
    }
    
    /**
     * Get all text from elements matching selector
     * @param selector Element selector
     * @return Array of text content
     */
    public String[] getAllTexts(String selector) {
        return page.locator(selector).allTextContents().toArray(new String[0]);
    }
    
    /**
     * Get element count
     * @param selector Element selector
     * @return Count of matching elements
     */
    public int getElementCount(String selector) {
        return page.locator(selector).count();
    }
}
