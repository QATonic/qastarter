package {{javaPackage}}.pages;

import {{javaPackage}}.utils.Log;
import org.openqa.selenium.By;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.FindBy;

import java.util.List;

/**
 * Home page object following Page Object Model pattern.
 * Contains locators and actions for home page functionality.
 */
public class HomePage extends BasePage {
    
    // Page locators using @FindBy annotation
    @FindBy(className = "welcome-message")
    private WebElement welcomeMessage;
    
    @FindBy(id = "user-menu")
    private WebElement userMenu;
    
    @FindBy(id = "logout-button")
    private WebElement logoutButton;
    
    @FindBy(className = "navigation-menu")
    private WebElement navigationMenu;
    
    @FindBy(css = ".main-content")
    private WebElement mainContent;
    
    @FindBy(css = ".sidebar")
    private WebElement sidebar;
    
    @FindBy(tagName = "footer")
    private WebElement footer;
    
    // Alternative locators using By objects
    private final By welcomeMessageLocator = By.className("welcome-message");
    private final By userMenuLocator = By.id("user-menu");
    private final By logoutButtonLocator = By.id("logout-button");
    private final By pageHeaderLocator = By.h1("Dashboard");
    private final By profileLinkLocator = By.linkText("Profile");
    private final By settingsLinkLocator = By.linkText("Settings");
    private final By notificationIconLocator = By.className("notification-icon");
    private final By searchBoxLocator = By.id("search-box");
    
    /**
     * Check if home page is loaded
     * @return true if home page is loaded
     */
    @Override
    public boolean isLoaded() {
        try {
            return isElementDisplayed(welcomeMessageLocator) && 
                   isElementDisplayed(userMenuLocator) &&
                   isElementDisplayed(pageHeaderLocator);
        } catch (Exception e) {
            Log.debug("Home page not loaded: " + e.getMessage());
            return false;
        }
    }
    
    /**
     * Get welcome message text
     * @return Welcome message text
     */
    public String getWelcomeMessage() {
        logPageAction("Getting welcome message");
        return getElementText(welcomeMessageLocator);
    }
    
    /**
     * Check if user is logged in by verifying welcome message contains username
     * @param expectedUsername Expected username in welcome message
     * @return true if welcome message contains username
     */
    public boolean isUserLoggedIn(String expectedUsername) {
        String welcomeText = getWelcomeMessage();
        boolean isLoggedIn = welcomeText.toLowerCase().contains(expectedUsername.toLowerCase());
        
        if (isLoggedIn) {
            Log.info("User is logged in. Welcome message: " + welcomeText);
        } else {
            Log.warn("User may not be logged in. Welcome message: " + welcomeText);
        }
        
        return isLoggedIn;
    }
    
    /**
     * Click user menu to expand dropdown
     * @return Current HomePage instance
     */
    public HomePage clickUserMenu() {
        logPageAction("Clicking user menu");
        clickElement(userMenuLocator);
        return this;
    }
    
    /**
     * Click logout button
     * @return LoginPage instance
     */
    public LoginPage logout() {
        logPageAction("Performing logout");
        clickUserMenu();
        clickElement(logoutButtonLocator);
        
        // Return LoginPage instance
        return new LoginPage();
    }
    
    /**
     * Navigate to profile page
     * @return ProfilePage instance (you would create this page class)
     */
    public HomePage navigateToProfile() {
        logPageAction("Navigating to profile page");
        clickElement(profileLinkLocator);
        // Return appropriate page object based on your application
        return this;
    }
    
    /**
     * Navigate to settings page
     * @return SettingsPage instance (you would create this page class)
     */
    public HomePage navigateToSettings() {
        logPageAction("Navigating to settings page");
        clickElement(settingsLinkLocator);
        // Return appropriate page object based on your application
        return this;
    }
    
    /**
     * Perform search
     * @param searchTerm Search term to enter
     * @return SearchResultsPage instance (you would create this page class)
     */
    public HomePage performSearch(String searchTerm) {
        logPageAction("Performing search: " + searchTerm);
        typeText(searchBoxLocator, searchTerm);
        
        // Press Enter or click search button
        driver.findElement(searchBoxLocator).submit();
        
        // Return appropriate page object based on your application
        return this;
    }
    
    /**
     * Check if notifications are available
     * @return true if notification icon shows new notifications
     */
    public boolean hasNotifications() {
        try {
            WebElement notificationIcon = waitForElement(notificationIconLocator);
            String notificationCount = notificationIcon.getAttribute("data-count");
            boolean hasNotifications = notificationCount != null && !notificationCount.equals("0");
            
            if (hasNotifications) {
                Log.info("Notifications available: " + notificationCount);
            } else {
                Log.debug("No new notifications");
            }
            
            return hasNotifications;
        } catch (Exception e) {
            Log.debug("Could not check notifications status");
            return false;
        }
    }
    
    /**
     * Get notification count
     * @return Number of notifications, or 0 if none
     */
    public int getNotificationCount() {
        try {
            WebElement notificationIcon = waitForElement(notificationIconLocator);
            String countText = notificationIcon.getAttribute("data-count");
            return countText != null ? Integer.parseInt(countText) : 0;
        } catch (Exception e) {
            Log.debug("Could not get notification count");
            return 0;
        }
    }
    
    /**
     * Click notification icon
     * @return Current HomePage instance
     */
    public HomePage clickNotifications() {
        logPageAction("Clicking notifications");
        clickElement(notificationIconLocator);
        return this;
    }
    
    /**
     * Check if sidebar is visible
     * @return true if sidebar is displayed
     */
    public boolean isSidebarVisible() {
        return isElementDisplayed(By.cssSelector(".sidebar"));
    }
    
    /**
     * Get main content text
     * @return Main content text
     */
    public String getMainContentText() {
        return getElementText(By.cssSelector(".main-content"));
    }
    
    /**
     * Navigate using sidebar menu
     * @param menuItemText Text of the menu item to click
     * @return Current HomePage instance
     */
    public HomePage navigateUsingSidebar(String menuItemText) {
        logPageAction("Navigating using sidebar menu: " + menuItemText);
        
        By menuItemLocator = By.xpath("//nav[@class='sidebar']//a[contains(text(), '" + menuItemText + "')]");
        clickElement(menuItemLocator);
        
        return this;
    }
    
    /**
     * Get all navigation menu items
     * @return List of navigation menu item texts
     */
    public java.util.List<String> getNavigationMenuItems() {
        logPageAction("Getting navigation menu items");
        
        List<WebElement> menuItems = driver.findElements(By.cssSelector(".navigation-menu a"));
        java.util.List<String> menuTexts = new java.util.ArrayList<>();
        
        for (WebElement item : menuItems) {
            menuTexts.add(item.getText());
        }
        
        Log.info("Found " + menuTexts.size() + " navigation menu items: " + menuTexts);
        return menuTexts;
    }
    
    /**
     * Verify page footer is displayed
     * @return true if footer is visible
     */
    public boolean isFooterDisplayed() {
        return isElementDisplayed(By.tagName("footer"));
    }
    
    /**
     * Get footer text
     * @return Footer text content
     */
    public String getFooterText() {
        return getElementText(By.tagName("footer"));
    }
    
    /**
     * Wait for page to fully load
     * @return true if page loaded successfully
     */
    public boolean waitForPageLoad() {
        logPageAction("Waiting for home page to fully load");
        
        try {
            waitForElement(welcomeMessageLocator);
            waitForElement(userMenuLocator);
            waitForElement(By.cssSelector(".main-content"));
            
            Log.info("Home page loaded successfully");
            return true;
        } catch (Exception e) {
            Log.error("Home page failed to load completely", e);
            return false;
        }
    }
    
    /**
     * Validate all critical page elements are present
     * @return true if all critical elements are present
     */
    public boolean validatePageElements() {
        logPageAction("Validating home page elements");
        
        boolean isValid = isElementDisplayed(welcomeMessageLocator) &&
                         isElementDisplayed(userMenuLocator) &&
                         isElementDisplayed(By.cssSelector(".main-content")) &&
                         isElementDisplayed(By.tagName("footer"));
        
        if (isValid) {
            Log.info("All home page elements are present and valid");
        } else {
            Log.error("Some home page elements are missing");
        }
        
        return isValid;
    }
    
    /**
     * Take a screenshot of the current page state
     * @param screenshotName Name for the screenshot
     */
    public void capturePageScreenshot(String screenshotName) {
        logPageAction("Capturing page screenshot: " + screenshotName);
        {{javaPackage}}.utils.ScreenshotUtils.captureScreenshot("homepage_" + screenshotName);
    }
}