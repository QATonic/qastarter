version: 2.1

orbs:
browser-tools: circleci/browser-tools@1.4

jobs:
test:
docker:
- image: cimg/openjdk:11.0-browsers
steps:
- checkout
- browser-tools/install-chrome

- restore_cache:
keys:
- v1-dependencies-{{"\{{checksum \"pom.xml\"\}}"}}
- v1-dependencies-

- run:
name: Build
command: mvn clean compile

- save_cache:
paths:
- ~/.m2
key: v1-dependencies-{{"\{{checksum \"pom.xml\"\}}"}}

- run:
name: Run Tests
command: mvn test -Dheadless=true

- store_test_results:
path: target/surefire-reports

- store_artifacts:
path: reports
destination: test-reports

- store_artifacts:
path: screenshots
destination: screenshots

- store_artifacts:
path: logs
destination: logs

workflows:
version: 2
build-and-test:
jobs:
- test