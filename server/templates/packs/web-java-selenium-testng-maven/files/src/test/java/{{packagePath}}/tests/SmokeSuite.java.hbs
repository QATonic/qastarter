package {{javaPackage}}.tests;

import {{javaPackage}}.core.BaseTest;
import {{javaPackage}}.pages.HomePage;
import {{javaPackage}}.pages.LoginPage;
import org.testng.Assert;
import org.testng.annotations.Test;

/**
 * Smoke test suite containing critical path tests.
 * These tests verify basic application functionality.
 */
public class SmokeSuite extends BaseTest {
    
    @Test(groups = {"smoke", "critical"}, 
          priority = 1,
          description = "Verify application loads and login page is accessible")
    public void testApplicationLoads() {
        // Navigate to base URL (done in BaseTest setUp)
        LoginPage loginPage = new LoginPage();
        
        // Verify login page loads
        Assert.assertTrue(loginPage.isLoaded(), 
                         "Login page should load successfully");
        
        // Verify page title
        String pageTitle = loginPage.getPageTitle();
        Assert.assertNotNull(pageTitle, "Page title should not be null");
        Assert.assertFalse(pageTitle.isEmpty(), "Page title should not be empty");
        
        // Verify essential elements
        Assert.assertTrue(loginPage.validatePageElements(), 
                         "All essential login page elements should be present");
    }
    
    @Test(groups = {"smoke", "critical"}, 
          priority = 2,
          dependsOnMethods = {"testApplicationLoads"},
          description = "Verify user can login with valid credentials")
    public void testUserCanLogin() {
        LoginPage loginPage = new LoginPage();
        
        // Perform login with default credentials
        HomePage homePage = loginPage.login("admin", "password123", HomePage.class);
        
        // Verify successful login
        Assert.assertTrue(homePage.isLoaded(), 
                         "Home page should load after successful login");
        
        // Verify user is logged in
        Assert.assertTrue(homePage.isUserLoggedIn("admin"), 
                         "User should be successfully logged in");
        
        // Verify welcome message
        String welcomeMessage = homePage.getWelcomeMessage();
        Assert.assertNotNull(welcomeMessage, "Welcome message should not be null");
        Assert.assertFalse(welcomeMessage.isEmpty(), "Welcome message should not be empty");
    }
    
    @Test(groups = {"smoke", "critical"}, 
          priority = 3,
          dependsOnMethods = {"testUserCanLogin"},
          description = "Verify home page functionality and navigation")
    public void testHomePageFunctionality() {
        LoginPage loginPage = new LoginPage();
        HomePage homePage = loginPage.login("admin", "password123", HomePage.class);
        
        // Verify page loaded completely
        Assert.assertTrue(homePage.waitForPageLoad(), 
                         "Home page should load completely");
        
        // Verify essential page elements
        Assert.assertTrue(homePage.validatePageElements(), 
                         "All essential home page elements should be present");
        
        // Verify sidebar is visible
        Assert.assertTrue(homePage.isSidebarVisible(), 
                         "Sidebar should be visible");
        
        // Verify footer is present
        Assert.assertTrue(homePage.isFooterDisplayed(), 
                         "Footer should be displayed");
        
        // Verify navigation menu items exist
        java.util.List<String> menuItems = homePage.getNavigationMenuItems();
        Assert.assertFalse(menuItems.isEmpty(), 
                          "Navigation menu should have items");
    }
    
    @Test(groups = {"smoke", "critical"}, 
          priority = 4,
          dependsOnMethods = {"testHomePageFunctionality"},
          description = "Verify user can logout successfully")
    public void testUserCanLogout() {
        LoginPage loginPage = new LoginPage();
        HomePage homePage = loginPage.login("admin", "password123", HomePage.class);
        
        // Verify user is logged in first
        Assert.assertTrue(homePage.isUserLoggedIn("admin"), 
                         "User should be logged in before logout test");
        
        // Perform logout
        LoginPage logoutPage = homePage.logout();
        
        // Verify logout successful
        Assert.assertTrue(logoutPage.isLoaded(), 
                         "Should return to login page after logout");
        
        // Verify user is logged out by checking page state
        String currentUrl = logoutPage.getCurrentUrl();
        Assert.assertTrue(currentUrl.toLowerCase().contains("login") || 
                         currentUrl.toLowerCase().contains("signin"),
                         "URL should indicate login page after logout");
    }
    
    @Test(groups = {"smoke", "negative"}, 
          priority = 5,
          description = "Verify login fails with invalid credentials")
    public void testInvalidLoginBlocked() {
        LoginPage loginPage = new LoginPage();
        
        // Attempt login with invalid credentials
        LoginPage resultPage = loginPage.login("invaliduser", "wrongpassword", LoginPage.class);
        
        // Verify login was blocked
        Assert.assertTrue(resultPage.isLoaded(), 
                         "Should remain on login page with invalid credentials");
        
        // Verify error handling
        boolean hasErrorFeedback = resultPage.isErrorMessageDisplayed() || 
                                  !resultPage.isLoginButtonEnabled();
        Assert.assertTrue(hasErrorFeedback, 
                         "Should show error feedback for invalid credentials");
    }
    
    @Test(groups = {"smoke", "ui"}, 
          priority = 6,
          description = "Verify critical UI elements and responsiveness")
    public void testCriticalUIElements() {
        LoginPage loginPage = new LoginPage();
        
        // Test login page UI
        Assert.assertTrue(loginPage.validatePageElements(), 
                         "Login page UI elements should be valid");
        
        // Test form interactions
        loginPage.enterUsername("testuser");
        Assert.assertEquals(loginPage.getUsernameValue(), "testuser", 
                           "Username field should accept input");
        
        // Test field clearing
        loginPage.clearUsername();
        Assert.assertEquals(loginPage.getUsernameValue(), "", 
                           "Username field should clear properly");
        
        // Test remember me checkbox
        loginPage.setRememberMe(true);
        Assert.assertTrue(loginPage.isRememberMeChecked(), 
                         "Remember me checkbox should work");
    }
    
    @Test(groups = {"smoke", "performance"}, 
          priority = 7,
          description = "Verify application loads within acceptable time")
    public void testApplicationPerformance() {
        long startTime = System.currentTimeMillis();
        
        LoginPage loginPage = new LoginPage();
        
        // Verify page loads within 10 seconds
        Assert.assertTrue(loginPage.isLoaded(), 
                         "Login page should load");
        
        long loadTime = System.currentTimeMillis() - startTime;
        Assert.assertTrue(loadTime < 10000, 
                         "Login page should load within 10 seconds. Actual: " + loadTime + "ms");
        
        // Test login performance
        startTime = System.currentTimeMillis();
        HomePage homePage = loginPage.login("admin", "password123", HomePage.class);
        long loginTime = System.currentTimeMillis() - startTime;
        
        Assert.assertTrue(homePage.isLoaded(), 
                         "Login should be successful");
        Assert.assertTrue(loginTime < 15000, 
                         "Login should complete within 15 seconds. Actual: " + loginTime + "ms");
    }
    
    @Test(groups = {"smoke", "accessibility"}, 
          priority = 8,
          description = "Basic accessibility and usability checks")
    public void testBasicAccessibility() {
        LoginPage loginPage = new LoginPage();
        
        // Verify page has proper title for screen readers
        String pageTitle = loginPage.getPageTitle();
        Assert.assertNotNull(pageTitle, "Page should have a title");
        Assert.assertTrue(pageTitle.trim().length() > 0, 
                         "Page title should not be empty");
        
        // Verify login button is enabled by default
        Assert.assertTrue(loginPage.isLoginButtonEnabled(), 
                         "Login button should be enabled");
        
        // Test keyboard navigation (basic check)
        loginPage.enterUsername("admin");
        loginPage.enterPassword("password123");
        
        // Verify form accepts input
        Assert.assertEquals(loginPage.getUsernameValue(), "admin", 
                           "Form should accept keyboard input");
    }
    
    @Test(groups = {"smoke", "data"}, 
          priority = 9,
          description = "Verify application handles data correctly")
    public void testDataHandling() {
        LoginPage loginPage = new LoginPage();
        HomePage homePage = loginPage.login("admin", "password123", HomePage.class);
        
        // Verify user data is displayed
        String welcomeMessage = homePage.getWelcomeMessage();
        Assert.assertTrue(welcomeMessage.contains("admin") || welcomeMessage.contains("Admin"), 
                         "Welcome message should contain user information");
        
        // Test search functionality if available
        try {
            homePage.performSearch("test search");
            // If search doesn't throw an exception, it's working
            Assert.assertTrue(true, "Search functionality is available");
        } catch (Exception e) {
            // Search might not be available in basic implementation
            Assert.assertTrue(true, "Search functionality may not be implemented yet");
        }
        
        // Verify navigation menu data
        java.util.List<String> menuItems = homePage.getNavigationMenuItems();
        for (String item : menuItems) {
            Assert.assertNotNull(item, "Menu item should not be null");
            Assert.assertFalse(item.trim().isEmpty(), "Menu item should not be empty");
        }
    }
    
    @Test(groups = {"smoke", "security"}, 
          priority = 10,
          description = "Basic security checks")
    public void testBasicSecurity() {
        LoginPage loginPage = new LoginPage();
        
        // Verify empty credentials are handled
        LoginPage emptyCredsResult = loginPage.login("", "", LoginPage.class);
        Assert.assertTrue(emptyCredsResult.isLoaded(), 
                         "Should stay on login page with empty credentials");
        
        // Verify special characters in credentials are handled
        LoginPage specialCharsResult = loginPage.login("admin'; DROP TABLE users; --", 
                                                      "' OR '1'='1", LoginPage.class);
        Assert.assertTrue(specialCharsResult.isLoaded(), 
                         "Should handle special characters safely");
        
        // Clear fields for next test
        specialCharsResult.clearAllFields();
        
        // Verify very long input is handled
        String longInput = "a".repeat(1000);
        specialCharsResult.enterUsername(longInput);
        String enteredValue = specialCharsResult.getUsernameValue();
        
        // Should either truncate or handle gracefully
        Assert.assertTrue(enteredValue.length() <= longInput.length(), 
                         "Should handle long input gracefully");
    }
}