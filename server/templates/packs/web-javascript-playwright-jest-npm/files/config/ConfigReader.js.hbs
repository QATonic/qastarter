/**
 * Configuration Reader - Load environment-specific settings.
 */
const dotenv = require("dotenv");
const fs = require("fs");
const path = require("path");

dotenv.config();

class ConfigurationReader {
  constructor() {
    this.config = {};
    this.loadConfig();
  }

  loadConfig() {
    const env = process.env.ENV || "dev";
    const configPath = path.join(__dirname, `${env}.json`);

    if (fs.existsSync(configPath)) {
      const content = fs.readFileSync(configPath, "utf-8");
      this.config = JSON.parse(content);
      console.log(`[Config] Loaded: ${configPath}`);
    }
  }

  get(key, defaultValue = "") {
    return process.env[key] || this.config[key] || defaultValue;
  }

  getNumber(key, defaultValue = 0) {
    const value = this.get(key);
    const parsed = parseInt(value, 10);
    return isNaN(parsed) ? defaultValue : parsed;
  }

  getBoolean(key, defaultValue = false) {
    const value = this.get(key);
    if (!value) return defaultValue;
    return ["true", "1", "yes"].includes(value.toLowerCase());
  }

  get baseUrl() { return this.get("BASE_URL", "https://www.saucedemo.com/"); }
  get browser() { return this.get("BROWSER", "chrome"); }
  get headless() { return this.getBoolean("HEADLESS", false); }
  get timeout() { return this.getNumber("TIMEOUT", 30000); }
  get username() { return this.get("USERNAME", "standard_user"); }
  get password() { return this.get("PASSWORD", "secret_sauce"); }
}

const config = new ConfigurationReader();
module.exports = { config };