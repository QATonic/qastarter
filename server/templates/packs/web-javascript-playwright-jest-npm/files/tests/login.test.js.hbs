/**
* Login Test Suite
*
* BEFORE RUNNING:
* 1. Update credentials in: data/dev.json
* 2. Update selectors in: pages/LoginPage.js
* 3. Run: npm test
*
* Demonstrates both configuration-based and data-driven testing.
*/
const LoginPage = require('../pages/LoginPage');
const envConfig = require('../config/env.config');
{{#if utilities.dataProvider}}
const TestDataReader = require('../utils/dataReader');
{{/if}}

describe('Login Tests', () => {
let loginPage;

beforeEach(async () => {
loginPage = new LoginPage(page);
});

test('should login with valid credentials', async () => {
// Get credentials from config file (data/dev.json)
const credentials = envConfig.getCredentials('validUser');

// Step 1: Navigate to login page
await loginPage.navigateToLogin();

// Step 2: Enter credentials and submit
await loginPage.login(credentials.username, credentials.password);

// Step 3: Verify login was successful
const isLoggedIn = await loginPage.isLoginSuccessful();
expect(isLoggedIn).toBe(true);
});

test('should display login page elements', async () => {
await loginPage.navigateToLogin();

expect(await loginPage.isUsernameVisible()).toBe(true);
expect(await loginPage.isPasswordVisible()).toBe(true);
});

{{#if utilities.dataProvider}}
/**
* Data-driven tests using test.each
* Reads test data from data/users.csv
*/
describe('Data-driven login tests', () => {
// Load CSV test data
const testData = TestDataReader.readCsv('users.csv');

test.each(testData)(
'should verify login for user: %s',
async (username, password, expected) => {
await loginPage.navigateToLogin();
await loginPage.login(username, password);

if (expected === 'success') {
const isLoggedIn = await loginPage.isLoginSuccessful();
expect(isLoggedIn).toBe(true);
} else {
const hasError = await loginPage.isErrorDisplayed();
expect(hasError).toBe(true);
}
}
);
});
{{/if}}
});