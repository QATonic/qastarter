"""
Base Page - Parent class for all page objects.

All page objects should extend this class to inherit common methods.
"""
from selenium.webdriver.remote.webdriver import WebDriver
from selenium.webdriver.remote.webelement import WebElement
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.by import By
from utils.driver_manager import DriverManager
from utils.logger import log
from config.config_reader import config


class BasePage:
    """Base class for all page objects."""
    
    def __init__(self):
        self.driver: WebDriver = DriverManager.get_driver()
        self.wait = WebDriverWait(self.driver, config.timeout)
    
    def click(self, locator: tuple):
        """Click an element."""
        log.action(f"Click: {locator}")
        self.wait.until(EC.element_to_be_clickable(locator)).click()
    
    def type_text(self, locator: tuple, text: str):
        """Type text into an element."""
        log.action(f"Type into: {locator}")
        element = self.wait.until(EC.visibility_of_element_located(locator))
        element.clear()
        element.send_keys(text)
    
    def get_text(self, locator: tuple) -> str:
        """Get text from an element."""
        return self.wait.until(EC.visibility_of_element_located(locator)).text
    
    def is_displayed(self, locator: tuple) -> bool:
        """Check if element is displayed."""
        try:
            return self.driver.find_element(*locator).is_displayed()
        except:
            return False
    
    def wait_for_element(self, locator: tuple) -> WebElement:
        """Wait for element to be visible."""
        return self.wait.until(EC.visibility_of_element_located(locator))
    
    def wait_for_clickable(self, locator: tuple) -> WebElement:
        """Wait for element to be clickable."""
        return self.wait.until(EC.element_to_be_clickable(locator))
    
    def get_title(self) -> str:
        """Get page title."""
        return self.driver.title
    
    def get_current_url(self) -> str:
        """Get current URL."""
        return self.driver.current_url
    
    def navigate_to(self, url: str):
        """Navigate to URL."""
        log.step(f"Navigating to: {url}")
        self.driver.get(url)
    
    def log_action(self, message: str):
        """Log a page action."""
        log.step(f"[{self.__class__.__name__}] {message}")