import { Given, When, Then, setWorldConstructor } from '@cucumber/cucumber';
import { expect } from '@playwright/test';
import { CustomWorld } from '../support/world';
import { LoginPage } from '../pages/LoginPage';
import { HomePage } from '../pages/HomePage';

setWorldConstructor(CustomWorld);

Given('I navigate to the login page', async function (this: CustomWorld) {
  const loginPage = new LoginPage(this.page);
  await loginPage.navigate();
});

When('I enter username {string} and password {string}', async function (
  this: CustomWorld,
  username: string,
  password: string
) {
  const loginPage = new LoginPage(this.page);
  if (username) {
    await loginPage.enterUsername(username);
  }
  if (password) {
    await loginPage.enterPassword(password);
  }
});

When('I click the login button', async function (this: CustomWorld) {
  const loginPage = new LoginPage(this.page);
  await loginPage.clickLoginButton();
});

Then('I should be redirected to the home page', async function (this: CustomWorld) {
  const homePage = new HomePage(this.page);
  const isHomePage = await homePage.isDisplayed();
  expect(isHomePage).toBeTruthy();
});

Then('I should see a welcome message', async function (this: CustomWorld) {
  const homePage = new HomePage(this.page);
  const welcomeMessage = await homePage.getWelcomeMessage();
  expect(welcomeMessage).toBeTruthy();
  expect(welcomeMessage).toContain('Welcome');
});

Then('I should see an error message {string}', async function (
  this: CustomWorld,
  expectedError: string
) {
  const loginPage = new LoginPage(this.page);
  const actualError = await loginPage.getErrorMessage();
  expect(actualError).toBeTruthy();
  expect(actualError).toContain(expectedError);
});

Then('I should remain on the login page', async function (this: CustomWorld) {
  const loginPage = new LoginPage(this.page);
  const isLoginPage = await loginPage.isDisplayed();
  expect(isLoginPage).toBeTruthy();
});
